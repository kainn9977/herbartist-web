import React, { useState } from 'react';
import { Sparkles, RefreshCw, ArrowRight, Wind, Sun, Coffee, Leaf, Moon, Heart, Star, Droplets, FlaskConical, Info, ChevronLeft, Tag, Undo2 } from 'lucide-react';

const HerbanStoreKiosk = () => {
  const [step, setStep] = useState('intro');
  const [selectedId, setSelectedId] = useState(null);
  const [showIngredients, setShowIngredients] = useState(false);
  const [lang, setLang] = useState('zh'); // 'zh', 'en', 'jp'

  // --- 語系字典 ---
  const t = {
    zh: {
      subBrand: 'HERBARTIST',
      title: <>植感生活<br/>診斷室</>,
      subtitle: '輕觸螢幕開啟您的草本對話',
      touchStart: 'Touch to Start',
      questionTitle: <>此刻的你，<br/>感覺如何？</>,
      questionSub: '請依直覺點選一張最符合的狀態',
      processing: '正在為您調配處方...',
      processingSub: 'Formulating Prescription',
      recommendation: 'Recommendation',
      checkIngredients: '查看成分與價格',
      backToSelection: '選其他症狀',
      backToIntro: '返回介紹',
      ingredientsTitle: '嚴選成分',
      originNote: '產地嚴選 ‧ 無化學添加',
      specTitle: 'Product Spec',
      brewingTitle: '沖泡建議：',
      cta: '如需購買，請直接洽詢櫃台人員',
      home: '回首頁',
      // V15: 優化免責聲明文字，使其更精簡以符合兩行顯示
      disclaimer: '免責聲明：本產品為一般食品，旨在調理生活機能。若有特殊疾病或懷孕狀況，建議諮詢醫師後飲用。'
    },
    en: {
      subBrand: 'HERBARTIST',
      title: <>Herbal Life<br/>Diagnosis</>,
      subtitle: 'Start your herbal dialogue',
      touchStart: 'Touch to Start',
      questionTitle: <>How do you feel<br/>right now?</>,
      questionSub: 'Intuitively choose the card that fits you best',
      processing: 'Blending...',
      processingSub: 'Formulating Prescription',
      recommendation: 'Recommendation',
      checkIngredients: 'Ingredients & Price',
      backToSelection: 'Choose Another',
      backToIntro: 'Back',
      ingredientsTitle: 'Ingredients',
      originNote: 'Selected Origins ‧ No Additives',
      specTitle: 'Product Spec',
      brewingTitle: 'Brewing:',
      cta: 'Please contact staff for purchase',
      home: 'Home',
      disclaimer: 'Disclaimer: This is a food product for well-being. Consult a physician if pregnant or having medical conditions.'
    },
    jp: {
      subBrand: 'HERBARTIST',
      title: <>漢方ライフ<br/>診断室</>,
      subtitle: 'ハーブとの対話を始めましょう',
      touchStart: 'Touch to Start',
      questionTitle: <>今の気分は<br/>いかがですか？</>,
      questionSub: '直感で最も当てはまるカードを選んでください',
      processing: '調合中...',
      processingSub: 'Formulating Prescription',
      recommendation: 'Recommendation',
      checkIngredients: '成分と価格を見る',
      backToSelection: '他の症状を選ぶ',
      backToIntro: '戻る',
      ingredientsTitle: '厳選成分',
      originNote: '厳選された産地 ‧ 無添加',
      specTitle: 'Product Spec',
      brewingTitle: '飲み方：',
      cta: 'ご購入の際はスタッフにお声がけください',
      home: 'ホーム',
      disclaimer: '免責事項：本品は健康食品です。疾患のある方や妊娠中の方は医師にご相談の上お飲みください。'
    }
  };

  // --- 產品資料庫 (V12版內容 + 啤酒含酒精資訊) ---
  const diagnosisData = [
    {
      id: 'heavy',
      icon: <Wind size={32} />,
      color: 'bg-green-50',
      accent: 'text-green-800',
      border: 'border-green-200',
      content: {
        zh: {
          label: '身體沉重',
          subLabel: 'Heavy Body',
          product: '阿公青草茶',
          engName: "Grandpa's Herbal Tea",
          slogan: '草本清香 ‧ 回甘順口',
          desc: '熬夜後、飲食油膩時的最佳夥伴。幫助身體回到清爽狀態，去除多餘的負擔。',
          ingredients: ['仙草', '鳳尾草', '白鶴靈芝', '黃花蜜菜', '甜菊葉', '紅田烏', '珠仔草'],
          specs: [
            { name: '經典 (10入)', desc: '需煮沸 (1200ml) ‧ 味道最濃郁', price: 'NT$ 480' },
            { name: '輕量 (10入)', desc: '馬克杯沖泡用 ‧ 方便快速', price: 'NT$ 300' }
          ],
          brewing: '【經典】1200ml水放入茶包，滾後轉中火12分鐘撈起。【輕量】熱水沖泡5-8分鐘即可。'
        },
        en: {
          label: 'Heavy Body',
          subLabel: 'Feeling Sluggish',
          product: "Grandpa's Herbal Tea",
          engName: "Traditional Cooling Blend",
          slogan: 'Herbal Aroma ‧ Smooth',
          desc: 'Best companion after staying up late. Helps the body return to a refreshed state.',
          ingredients: ['Mesona', 'Pteris', 'White Crane Lingzhi', 'Wedelia', 'Stevia', 'Alternanthera', 'Phyllanthus'],
          specs: [
            { name: 'Classic (10 packs)', desc: 'Boiling required (1200ml)', price: 'NT$ 480' },
            { name: 'Light (10 packs)', desc: 'Mug brewing type', price: 'NT$ 300' }
          ],
          brewing: '[Classic] Boil with 1200ml water for 12 mins. [Light] Brew with hot water for 5-8 mins.'
        },
        jp: {
          label: '体がだるい',
          subLabel: 'Heavy Body',
          product: 'おじいちゃんの青草茶',
          engName: "Grandpa's Herbal Tea",
          slogan: 'ハーブの香り ‧ スッキリとした後味',
          desc: '夜更かしや脂っこい食事の後に。体に溜まった熱を冷まし、軽やかな状態へ戻します。',
          ingredients: ['仙草', 'イノモトソウ', '白鶴霊芝', 'クマノギク', 'ステビア', 'ツルノゲイトウ', 'コミカンソウ'],
          specs: [
            { name: 'クラシック (10入)', desc: '要煮沸 (1200ml) ‧ 濃厚な味わい', price: 'NT$ 480' },
            { name: 'ライト (10入)', desc: 'マグカップ用 ‧ 手軽に楽しめる', price: 'NT$ 300' }
          ],
          brewing: '【クラシック】1200mlの水で沸騰後、弱火で12分。【ライト】お湯で5-8分抽出。'
        }
      }
    },
    {
      id: 'tired',
      icon: <Coffee size={32} />,
      color: 'bg-stone-100',
      accent: 'text-stone-800',
      border: 'border-stone-300',
      content: {
        zh: {
          label: '缺乏元氣',
          subLabel: 'Low Energy',
          product: '黑豆牛蒡茶',
          engName: 'Black Bean & Burdock',
          slogan: '焙炒香氣 ‧ 溫潤厚實',
          desc: '適合久坐、外食族。作為日常的溫和滋養，找回穩定的節奏。',
          ingredients: ['黑大豆', '牛蒡', '大麥'],
          specs: [{ name: '盒裝 (10入)', desc: '馬克杯用 (350-500ml)', price: 'NT$ 300' }],
          brewing: '務必以熱水沖泡，5-8 分鐘即可出味，可回沖 2-3 次。'
        },
        en: {
          label: 'Low Energy',
          subLabel: 'Feeling Tired',
          product: 'Black Bean & Burdock',
          engName: 'Energy Boost',
          slogan: 'Roasted Aroma ‧ Warm & Rich',
          desc: 'Perfect for sedentary office workers. Gentle nourishment to restore your daily rhythm.',
          ingredients: ['Black Soybean', 'Burdock Root', 'Barley'],
          specs: [{ name: 'Box (10 packs)', desc: 'For Mug (350-500ml)', price: 'NT$ 300' }],
          brewing: 'Brew with hot water for 5-8 mins. Can be re-brewed 2-3 times.'
        },
        jp: {
          label: '元気がない',
          subLabel: 'Low Energy',
          product: '黒豆ごぼう茶',
          engName: 'Black Bean & Burdock',
          slogan: '香ばしい香り ‧ 温かみのある味',
          desc: '座りっぱなしの方や外食が多い方に。日常の優しい滋養として、リズムを整えます。',
          ingredients: ['黒豆', 'ごぼう', '大麦'],
          specs: [{ name: '箱入り (10入)', desc: 'マグカップ用 (350-500ml)', price: 'NT$ 300' }],
          brewing: 'お湯で5-8分抽出してください。2-3回楽しめます。'
        }
      }
    },
    {
      id: 'full',
      icon: <Leaf size={32} />,
      color: 'bg-amber-50',
      accent: 'text-amber-800',
      border: 'border-amber-200',
      content: {
        zh: {
          label: '大餐過後',
          subLabel: 'Digestion',
          product: '大麥決明子茶',
          engName: 'Barley & Cassia Tea',
          slogan: '麥味飄香 ‧ 決明清爽',
          desc: '飯後來一杯，解膩又輕盈。讓身體的負擔像落葉般自然代謝。',
          ingredients: ['大麥', '玉米鬚', '決明子'],
          specs: [{ name: '盒裝 (10入)', desc: '馬克杯用 (350-500ml)', price: 'NT$ 300' }],
          brewing: '務必以熱水沖泡，5-8 分鐘即可出味，可回沖 2-3 次。'
        },
        en: {
          label: 'After Meal',
          subLabel: 'Digestion',
          product: 'Barley & Cassia Tea',
          engName: 'Light & Refreshing',
          slogan: 'Barley Scent ‧ Refreshing',
          desc: 'A cup after meals to relieve greasiness. Let the body burden metabolize naturally.',
          ingredients: ['Barley', 'Corn Silk', 'Cassia Seed'],
          specs: [{ name: 'Box (10 packs)', desc: 'For Mug (350-500ml)', price: 'NT$ 300' }],
          brewing: 'Brew with hot water for 5-8 mins. Can be re-brewed 2-3 times.'
        },
        jp: {
          label: '食後の重み',
          subLabel: 'Digestion',
          product: '大麦決明子茶',
          engName: 'Barley & Cassia Tea',
          slogan: '麦の香り ‧ すっきり爽やか',
          desc: '食後の一杯に。脂っこさを消し、体を軽やかに保ちます。',
          ingredients: ['大麦', 'トウモロコシのひげ', '決明子'],
          specs: [{ name: '箱入り (10入)', desc: 'マグカップ用 (350-500ml)', price: 'NT$ 300' }],
          brewing: 'お湯で5-8分抽出してください。2-3回楽しめます。'
        }
      }
    },
    {
      id: 'eye',
      icon: <Sun size={32} />,
      color: 'bg-yellow-50',
      accent: 'text-yellow-700',
      border: 'border-yellow-200',
      content: {
        zh: {
          label: '眼神疲憊',
          subLabel: 'Eye Strain',
          product: '杭菊枸杞茶',
          engName: 'Chrysanthemum & Goji',
          slogan: '花香淡雅 ‧ 自然甘甜',
          desc: '長時間用眼、需要放鬆時的溫柔選擇。淡淡的花香撫平視覺的躁動。',
          ingredients: ['杭菊', '枸杞', '決明子'],
          specs: [{ name: '盒裝 (10入)', desc: '馬克杯用 (350-500ml)', price: 'NT$ 300' }],
          brewing: '務必以熱水沖泡，5-8 分鐘即可出味，可回沖 2-3 次。'
        },
        en: {
          label: 'Eye Strain',
          subLabel: 'Screen Time',
          product: 'Chrysanthemum & Goji',
          engName: 'Vision Care',
          slogan: 'Floral Scent ‧ Sweet',
          desc: 'A gentle choice for tired eyes from screen time. The floral scent soothes visual agitation.',
          ingredients: ['Chrysanthemum', 'Goji Berry', 'Cassia Seed'],
          specs: [{ name: 'Box (10 packs)', desc: 'For Mug (350-500ml)', price: 'NT$ 300' }],
          brewing: 'Brew with hot water for 5-8 mins. Can be re-brewed 2-3 times.'
        },
        jp: {
          label: '目の疲れ',
          subLabel: 'Eye Strain',
          product: '菊花クコ茶',
          engName: 'Chrysanthemum & Goji',
          slogan: '花の香り ‧ 自然な甘み',
          desc: 'スマホやPCで目が疲れた時に。優しい花の香りが視覚の疲れを癒します。',
          ingredients: ['菊花', 'クコの実', '決明子'],
          specs: [{ name: '箱入り (10入)', desc: 'マグカップ用 (350-500ml)', price: 'NT$ 300' }],
          brewing: 'お湯で5-8分抽出してください。2-3回楽しめます。'
        }
      }
    },
    {
      id: 'cold',
      icon: <Heart size={32} />,
      color: 'bg-red-50',
      accent: 'text-red-800',
      border: 'border-red-200',
      content: {
        zh: {
          label: '手腳冰冷',
          subLabel: 'Cold Hands',
          product: '抹上口紅前',
          engName: '紅棗南薑茶',
          slogan: '暖身防護 ‧ 溫潤舒活',
          desc: '老薑的暖意加上紅棗的甘甜，由內而外升溫。適合空調房久坐、需要好氣色的妳。',
          ingredients: ['紅棗', '南薑', '魚腥草', '甘草', '桑葉'],
          specs: [{ name: '精緻盒裝 (6入)', desc: '馬克杯用 (350-500ml)', price: 'NT$ 360' }],
          brewing: '務必以熱水沖泡，5-8 分鐘即可出味，可回沖 2-3 次。'
        },
        en: {
          label: 'Feeling Cold',
          subLabel: 'Cold Hands',
          product: 'Before Lipstick',
          engName: 'Red Date & Galangal',
          slogan: 'Warming ‧ Comforting',
          desc: 'The warmth of old ginger meets red dates. Perfect for AC rooms and glowing skin.',
          ingredients: ['Red Date', 'Galangal', 'Houttuynia', 'Licorice', 'Mulberry Leaf'],
          specs: [{ name: 'Gift Box (6 packs)', desc: 'For Mug (350-500ml)', price: 'NT$ 360' }],
          brewing: 'Brew with hot water for 5-8 mins. Can be re-brewed 2-3 times.'
        },
        jp: {
          label: '冷え性',
          subLabel: 'Cold Hands',
          product: '口紅を塗る前に',
          engName: 'ナツメと南姜の茶',
          slogan: '温活 ‧ 潤い',
          desc: '生姜の温かさとナツメの甘さ。冷房対策や顔色を良くしたい方に最適です。',
          ingredients: ['ナツメ', '南姜', 'ドクダミ', '甘草', '桑の葉'],
          specs: [{ name: 'ギフト箱 (6入)', desc: 'マグカップ用 (350-500ml)', price: 'NT$ 360' }],
          brewing: 'お湯で5-8分抽出してください。2-3回楽しめます。'
        }
      }
    },
    {
      id: 'sleep',
      icon: <Moon size={32} />,
      color: 'bg-indigo-50',
      accent: 'text-indigo-800',
      border: 'border-indigo-200',
      content: {
        zh: {
          label: '思緒紛亂',
          subLabel: 'Insomnia',
          product: '午後的脫妝',
          engName: '龍眼花洋甘菊茶',
          slogan: '靜謐之夜 ‧ 夢境引導',
          desc: '龍眼花的蜜香交織洋甘菊的安撫，讓緊繃的思緒慢慢鬆開。不含咖啡因，是睡前最溫柔的儀式。',
          ingredients: ['龍眼花', '洋甘菊', '大花咸豐草', '百合'],
          specs: [{ name: '精緻盒裝 (6入)', desc: '馬克杯用 (350-500ml)', price: 'NT$ 360' }],
          brewing: '務必以熱水沖泡，5-8 分鐘即可出味，可回沖 2-3 次。'
        },
        en: {
          label: 'Restless Mind',
          subLabel: 'Insomnia',
          product: 'Afternoon Touch-up',
          engName: 'Longan & Chamomile',
          slogan: 'Silent Night ‧ Dream Guide',
          desc: 'Honey scent of Longan flowers meets Chamomile. Caffeine-free, gentle ritual before bed.',
          ingredients: ['Longan Flower', 'Chamomile', 'Bidens Alba', 'Lily Bulb'],
          specs: [{ name: 'Gift Box (6 packs)', desc: 'For Mug (350-500ml)', price: 'NT$ 360' }],
          brewing: 'Brew with hot water for 5-8 mins. Can be re-brewed 2-3 times.'
        },
        jp: {
          label: '考え事が多い',
          subLabel: 'Insomnia',
          product: '午後の化粧崩れ',
          engName: '龍眼花とカモミール',
          slogan: '静寂の夜 ‧ 夢への誘い',
          desc: '龍眼花の蜜の香りとカモミールの安らぎ。ノンカフェインで、お休み前の優しい儀式に。',
          ingredients: ['龍眼花', 'カモミール', 'タチアワユキセンダングサ', '百合'],
          specs: [{ name: 'ギフト箱 (6入)', desc: 'マグカップ用 (350-500ml)', price: 'NT$ 360' }],
          brewing: 'お湯で5-8分抽出してください。2-3回楽しめます。'
        }
      }
    },
    {
      id: 'period',
      icon: <Star size={32} />,
      color: 'bg-orange-50',
      accent: 'text-orange-800',
      border: 'border-orange-200',
      content: {
        zh: {
          label: '月月不適',
          subLabel: 'Period Care',
          product: '素顏悄悄話',
          engName: '土肉桂枸杞茶',
          slogan: '溫柔調理 ‧ 暖心呵護',
          desc: '台灣原生土肉桂的獨特香氣，像暖暖包一樣貼心，陪伴妳度過敏感時刻。溫潤不燥熱。',
          ingredients: ['土肉桂', '甘草', '枸杞', '洋甘菊', '玫瑰果'],
          specs: [{ name: '精緻盒裝 (6入)', desc: '馬克杯用 (350-500ml)', price: 'NT$ 360' }],
          brewing: '務必以熱水沖泡，5-8 分鐘即可出味，可回沖 2-3 次。'
        },
        en: {
          label: 'Period Care',
          subLabel: 'Monthly Care',
          product: 'Whisper of Bare Skin',
          engName: 'Indigenous Cinnamon',
          slogan: 'Gentle Care ‧ Warming',
          desc: 'Unique aroma of Indigenous Cinnamon. Like a warm hug during sensitive times.',
          ingredients: ['Indigenous Cinnamon', 'Licorice', 'Goji Berry', 'Chamomile', 'Rosehip'],
          specs: [{ name: 'Gift Box (6 packs)', desc: 'For Mug (350-500ml)', price: 'NT$ 360' }],
          brewing: 'Brew with hot water for 5-8 mins. Can be re-brewed 2-3 times.'
        },
        jp: {
          label: '女性の悩み',
          subLabel: 'Period Care',
          product: 'すっぴんの囁き',
          engName: '台湾シナモン茶',
          slogan: '優しい調理 ‧ 心温まるケア',
          desc: '台湾原生シナモンの独特な香り。敏感な時期に、カイロのように寄り添います。',
          ingredients: ['台湾シナモン', '甘草', 'クコの実', 'カモミール', 'ローズヒップ'],
          specs: [{ name: 'ギフト箱 (6入)', desc: 'マグカップ用 (350-500ml)', price: 'NT$ 360' }],
          brewing: 'お湯で5-8分抽出してください。2-3回楽しめます。'
        }
      }
    },
    {
      id: 'party',
      icon: <Droplets size={32} />,
      color: 'bg-emerald-900',
      accent: 'text-emerald-100',
      border: 'border-emerald-700',
      content: {
        zh: {
          label: '想喝一杯',
          subLabel: 'Chill Vibes',
          product: '青草茶啤酒',
          engName: 'Herbal Sparkling Beer',
          slogan: '都會微醺 ‧ 泡沫綿密',
          desc: '將老祖宗的智慧打入綿密氣泡。大人味的清爽特調，派對狂歡的獨特選擇。',
          ingredients: ['仙草', '鳳尾草', '白鶴靈芝', '黃花蜜菜', '甜菊葉', '紅田烏', '珠仔草', '酵母'],
          specs: [{ name: '瓶裝 (330ml)', desc: '酒精濃度：4.8%', price: 'NT$ 180' }],
          brewing: '冷藏飲用風味更佳，開瓶後請盡快飲用。'
        },
        en: {
          label: 'Chill Vibes',
          subLabel: 'Sparkling Beer',
          product: 'Herbal Sparkling Beer',
          engName: 'Urban Buzz',
          slogan: 'Urban Chill ‧ Creamy',
          desc: 'Ancestral wisdom infused into bubbles. A refreshing herbal beer for a unique party vibe.',
          ingredients: ['Mesona', 'Pteris', 'White Crane Lingzhi', 'Wedelia', 'Stevia', 'Alternanthera', 'Phyllanthus', 'Yeast'],
          specs: [{ name: 'Bottle (330ml)', desc: 'ABV: 4.8%', price: 'NT$ 180' }],
          brewing: 'Best served chilled. Drink immediately after opening.'
        },
        jp: {
          label: '一杯飲みたい',
          subLabel: 'Chill Vibes',
          product: '青草茶ビール',
          engName: 'Herbal Sparkling Beer',
          slogan: '都会の微酔 ‧ クリーミー',
          desc: '先人の知恵を炭酸に込めました。爽やかなハーバルビールで、特別なひとときを。',
          ingredients: ['仙草', 'イノモトソウ', '白鶴霊芝', 'クマノギク', 'ステビア', 'ツルノゲイトウ', 'コミカンソウ', '酵母'],
          specs: [{ name: '瓶 (330ml)', desc: 'アルコール分：4.8%', price: 'NT$ 180' }],
          brewing: '冷やして飲むのがおすすめ。開封後はお早めに。'
        }
      }
    }
  ];

  const handleSelect = (id) => {
    setSelectedId(id);
    setStep('processing');
    setShowIngredients(false);
    setTimeout(() => {
      setStep('result');
    }, 1500);
  };

  const handleReset = () => {
    setStep('intro');
    setSelectedId(null);
    setShowIngredients(false);
  };

  const handleBackToSelection = () => {
    setStep('selection');
    setSelectedId(null);
    setShowIngredients(false);
  };

  const currentResult = diagnosisData.find(d => d.id === selectedId);
  const currentLangContent = currentResult ? currentResult.content[lang] : null;

  return (
    <div className="w-full min-h-screen bg-[#FDFBF7] text-[#1A3C34] font-serif flex items-center justify-center p-4 md:p-8 select-none">
      
      {/* 門市平板外框 */}
      <div className="relative w-full max-w-5xl bg-white rounded-3xl shadow-2xl overflow-hidden border-[12px] border-[#1A3C34] min-h-[800px] flex flex-col">
        
        {/* Header - V12: padding 調整 (pr-4) */}
        <div className="absolute top-0 w-full pl-8 pr-4 py-8 flex justify-between items-center z-20 pointer-events-none">
          <div className="flex flex-col">
            {/* Logo 圖片 */}
            <img 
              src="image.png" 
              alt="賣艸人家 HERBARTIST Logo" 
              className="h-20 w-auto object-contain"
              onError={(e) => {
                e.target.style.display = 'none'; 
                e.target.nextSibling.style.display = 'flex';
              }}
            />
            {/* Fallback Text */}
            <div className="hidden flex-col">
                <span className="text-xl font-bold tracking-[0.2em] text-[#1A3C34]">賣艸人家</span>
                <span className="text-xs text-[#D4AF37] tracking-[0.3em] uppercase mt-1">HERBARTIST</span>
            </div>
          </div>
          
          <div className="pointer-events-auto flex gap-2 items-center">
             <div className="bg-white/90 backdrop-blur rounded-full shadow-sm border border-[#1A3C34]/10 flex overflow-hidden">
                {['zh', 'en', 'jp'].map((l) => (
                  <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`px-3 py-1.5 text-[10px] font-bold uppercase transition-colors ${lang === l ? 'bg-[#1A3C34] text-[#D4AF37]' : 'text-gray-400 hover:text-[#1A3C34]'}`}
                  >
                    {l === 'zh' ? '中' : l}
                  </button>
                ))}
             </div>

             {step !== 'intro' && (
                <button 
                    onClick={handleReset} 
                    className="bg-white/90 backdrop-blur p-2 rounded-full hover:bg-[#D4AF37] hover:text-white transition shadow-sm border border-[#1A3C34]/10 flex items-center group"
                >
                  <RefreshCw size={16} className="group-hover:rotate-180 transition-transform duration-500" />
                </button>
             )}
          </div>
        </div>

        {/* --- STEP 1: INTRO (待機畫面) --- */}
        {step === 'intro' && (
           <div className="flex-1 flex flex-col items-center justify-center text-center p-12 animate-fade-in relative overflow-hidden mt-10" onClick={() => setStep('selection')}>
             <div className="absolute w-[500px] h-[500px] bg-[#F2D4D7] rounded-full blur-[100px] opacity-30 animate-pulse"></div>
             <div className="relative z-10 cursor-pointer">
                <div className="w-24 h-24 border-2 border-[#D4AF37] rounded-full flex items-center justify-center mx-auto mb-8 bg-white/50 backdrop-blur-sm shadow-lg">
                    <Sparkles className="text-[#D4AF37] animate-pulse" size={40} />
                </div>
                <h1 className="text-5xl md:text-6xl font-bold mb-6 tracking-widest text-[#1A3C34] leading-tight mt-4">
                  {t[lang].title}
                </h1>
                <div className="h-1 w-20 bg-[#D4AF37] mx-auto my-8"></div>
                <p className="text-lg text-[#1A3C34]/70 leading-loose tracking-widest">
                  {t[lang].subtitle}
                </p>
                <div className="mt-12 animate-bounce text-[#D4AF37]">
                   <span className="text-sm tracking-[0.3em] uppercase">{t[lang].touchStart}</span>
                </div>
             </div>
             {/* V15: 免責聲明 - 調整字級與寬度確保兩行內顯示 */}
             <div className="absolute bottom-4 w-full px-8 flex justify-center opacity-60">
                <p className="text-[9px] text-gray-500 tracking-wider leading-tight max-w-[85%]">
                   {t[lang].disclaimer}
                </p>
             </div>
           </div>
        )}

        {/* --- STEP 2: SELECTION (選擇症狀) --- */}
        {step === 'selection' && (
          <div className="flex-1 flex flex-col pt-24 pb-10 px-6 md:px-16 bg-[#FDFBF7] animate-slide-up">
            
            <div className="text-center mb-6">
               <h2 className="text-3xl font-bold tracking-widest text-[#1A3C34] leading-relaxed">
                 {t[lang].questionTitle}
               </h2>
               <div className="w-8 h-1 bg-[#D4AF37] mx-auto my-4"></div>
               <p className="text-sm text-gray-500 tracking-wider">{t[lang].questionSub}</p>
            </div>

            <div className="flex-1 overflow-y-auto pt-4 pb-4 px-2">
              <div className="grid grid-cols-2 md:grid-cols-4 gap-6 content-start">
                {diagnosisData.map((item) => (
                  <button 
                    key={item.id} 
                    onClick={() => handleSelect(item.id)} 
                    // V15: 回歸 V12 的 aspect-square (正方形卡片)
                    className={`group relative bg-white border-2 border-transparent rounded-2xl p-4 pb-8 flex flex-col items-center justify-between shadow-sm hover:border-[#D4AF37] hover:shadow-xl hover:-translate-y-1 transition-all duration-300 aspect-square`}
                  >
                    <div className={`p-3 rounded-full bg-gray-50 group-hover:bg-[#1A3C34] group-hover:text-[#D4AF37] text-[#1A3C34] transition-colors duration-500 mt-2`}>
                      {item.icon}
                    </div>

                    <div className="text-center w-full px-1">
                      {/* 字體適應邏輯：中文不換行，英日文縮小且允許換行 */}
                      <h3 className={`font-bold tracking-wide text-[#1A3C34] mb-1 leading-tight ${lang === 'zh' ? 'text-lg whitespace-nowrap' : 'text-xs'}`}>
                          {item.content[lang].label}
                      </h3>
                      <p className="text-[9px] text-gray-400 uppercase tracking-widest">{item.content[lang].subLabel}</p>
                    </div>

                    <div className="absolute bottom-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-[#D4AF37]">
                      <ArrowRight size={16} />
                    </div>
                  </button>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* --- STEP 3: PROCESSING --- */}
        {step === 'processing' && (
          <div className="flex-1 flex flex-col items-center justify-center bg-[#0A3F2F] text-white">
             <div className="relative">
               <div className="absolute inset-0 border-4 border-[#D4AF37]/20 rounded-full animate-ping"></div>
               <div className="w-24 h-24 border-4 border-[#D4AF37] border-t-transparent rounded-full animate-spin flex items-center justify-center"></div>
               <FlaskConical className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[#D4AF37]" size={32} />
             </div>
             <p className="mt-10 tracking-[0.3em] font-light text-xl animate-pulse">{t[lang].processing}</p>
             <p className="text-xs text-white/40 mt-3 tracking-widest uppercase">{t[lang].processingSub}</p>
          </div>
        )}

        {/* --- STEP 4: RESULT --- */}
        {step === 'result' && currentResult && currentLangContent && (
          <div className="flex-1 flex flex-col md:flex-row items-stretch bg-[#FDFBF7] animate-fade-in">
            
            {/* 左側：視覺形象區 */}
            <div className={`w-full md:w-5/12 ${currentResult.color} p-8 flex flex-col items-center justify-center text-center relative overflow-hidden transition-colors duration-700`}>
               <div className={`absolute -right-12 -bottom-12 opacity-10 scale-[2.5] ${currentResult.accent}`}>
                 {currentResult.icon}
               </div>
               <div className={`relative z-10 w-28 h-28 rounded-full border-4 ${currentResult.border} flex items-center justify-center bg-white/60 mb-6 shadow-lg backdrop-blur-sm`}>
                 <span className={`${currentResult.accent}`}>{currentResult.icon}</span>
               </div>
               <h3 className={`font-bold tracking-[0.2em] ${currentResult.accent} mb-2 ${lang === 'zh' ? 'text-2xl' : 'text-xl'}`}>
                  {currentLangContent.label}
               </h3>
               <div className={`h-[2px] w-12 ${currentResult.accent} opacity-50 my-4`}></div>
               <p className={`text-xs tracking-widest uppercase opacity-80 ${currentResult.accent}`}>Herban Diagnosis</p>
            </div>

            {/* 右側：內容切換區 */}
            <div className="w-full md:w-7/12 p-8 md:p-12 flex flex-col bg-white relative overflow-y-auto">
              
              {!showIngredients ? (
                // --- 模式 A: 產品故事 ---
                <div className="flex flex-col h-full justify-between animate-slide-up">
                  <div className="space-y-6">
                     <div>
                        <span className="text-[#D4AF37] text-xs font-bold tracking-[0.3em] uppercase block mb-3">{t[lang].recommendation}</span>
                        
                        <h2 className={`font-bold text-[#1A3C34] mb-2 ${lang === 'zh' ? 'text-4xl whitespace-nowrap' : 'text-3xl'}`}>
                            {currentLangContent.product}
                        </h2>
                        
                        <p className="text-sm text-gray-500 font-serif italic">{currentLangContent.engName}</p>
                     </div>

                     <div className="pl-6 border-l-4 border-[#1A3C34]">
                        <p className="text-xl font-bold text-[#1A3C34] leading-relaxed">「{currentLangContent.slogan}」</p>
                     </div>
                     
                     <p className="text-slate-600 leading-loose tracking-wide text-justify text-lg">
                       {currentLangContent.desc}
                     </p>
                  </div>

                  <div className="pt-8 space-y-4">
                    <button 
                      onClick={() => setShowIngredients(true)}
                      className="group w-full border-2 border-[#1A3C34] text-[#1A3C34] py-5 rounded-xl tracking-[0.2em] font-bold hover:bg-[#1A3C34] hover:text-[#D4AF37] transition-all duration-300 flex items-center justify-center gap-3 shadow-sm hover:shadow-lg"
                    >
                      <Info size={20} />
                      {t[lang].checkIngredients}
                      <ArrowRight size={20} className="opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all" />
                    </button>
                    
                    <button 
                      onClick={handleBackToSelection}
                      className="w-full py-3 text-gray-400 hover:text-[#1A3C34] text-sm tracking-widest transition-colors flex items-center justify-center gap-2"
                    >
                      <Undo2 size={16} />
                      {t[lang].backToSelection}
                    </button>
                  </div>
                  
                  {/* V15: 免責聲明 (產品頁底部) */}
                  <div className="mt-auto pt-4 border-t border-gray-100">
                     <p className="text-[9px] text-gray-400 text-center leading-relaxed">
                       {t[lang].disclaimer}
                     </p>
                  </div>
                </div>
              ) : (
                // --- 模式 B: 成分細節與價格 ---
                <div className="flex flex-col h-full animate-scale-in">
                  <button 
                    onClick={() => setShowIngredients(false)}
                    className="flex items-center text-gray-400 hover:text-[#1A3C34] transition-colors mb-4 group w-fit"
                  >
                    <ChevronLeft size={20} className="group-hover:-translate-x-1 transition-transform" />
                    <span className="text-sm tracking-widest ml-1">{t[lang].backToIntro}</span>
                  </button>

                  <h2 className="text-2xl font-bold text-[#1A3C34] mb-4 flex items-center gap-3">
                    <Leaf className="text-[#D4AF37]" size={24} />
                    {t[lang].ingredientsTitle}
                  </h2>

                  {/* 成分清單 */}
                  <div className="bg-[#FDFBF7] p-6 rounded-xl border border-[#D4AF37]/30 mb-6 flex-grow w-full">
                    <ul className="grid grid-cols-2 gap-y-3 gap-x-4">
                      {currentLangContent.ingredients && currentLangContent.ingredients.map((item, index) => (
                        <li key={index} className="flex items-center text-base text-[#1A3C34]">
                          <span className="w-1.5 h-1.5 bg-[#D4AF37] rounded-full mr-2.5 shrink-0"></span>
                          <span className="break-words">{item}</span>
                        </li>
                      ))}
                    </ul>
                    <div className="mt-4 pt-3 border-t border-[#1A3C34]/10">
                      <p className="text-xs text-gray-500 tracking-wider">
                        {t[lang].originNote}
                      </p>
                    </div>
                  </div>

                  {/* 價格與規格區 */}
                  <div className="bg-white border-2 border-[#1A3C34] rounded-xl p-5 shadow-lg w-full">
                     <h3 className="text-sm text-[#D4AF37] tracking-[0.2em] font-bold uppercase mb-3 flex items-center gap-2">
                        <Tag size={16} /> {t[lang].specTitle}
                     </h3>
                     
                     <div className="space-y-3">
                        {currentLangContent.specs && currentLangContent.specs.map((spec, idx) => (
                           <div key={idx} className="flex justify-between items-center border-b border-gray-100 last:border-0 pb-3 last:pb-0">
                              <div className="flex-1 pr-2 min-w-0">
                                 <p className="font-bold text-[#1A3C34] text-base truncate md:whitespace-normal">{spec.name}</p>
                                 <p className="text-xs text-gray-500 mt-1 break-words">{spec.desc}</p>
                              </div>
                              <p className="font-bold text-[#1A3C34] text-xl shrink-0 whitespace-nowrap">{spec.price}</p>
                           </div>
                        ))}
                     </div>
                     
                     {currentLangContent.brewing && (
                       <div className="mt-4 pt-3 border-t border-gray-100 flex items-start gap-2">
                          <FlaskConical size={14} className="text-[#D4AF37] mt-1 shrink-0" />
                          <p className="text-xs text-gray-500 leading-relaxed">
                            <span className="font-bold text-[#1A3C34]">{t[lang].brewingTitle}</span>{currentLangContent.brewing}
                          </p>
                       </div>
                     )}
                  </div>
                  
                  {/* 底部 CTA */}
                  <div className="text-center mt-4">
                    <p className="text-[#1A3C34] text-xs font-bold tracking-widest animate-pulse">
                      {t[lang].cta}
                    </p>
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        {/* 平板底部裝飾條 */}
        <div className="h-4 bg-[#1A3C34] w-full mt-auto flex items-center justify-center">
            <div className="w-1/3 h-1 bg-[#D4AF37]/50 rounded-full"></div>
        </div>
      </div>

      {/* Tailwind Animations */}
      <style>{`
        .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; }
        .animate-slide-up { animation: slideUp 0.6s ease-out forwards; }
        .animate-scale-in { animation: scaleIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
      `}</style>
    </div>
  );
};

export default HerbanStoreKiosk;